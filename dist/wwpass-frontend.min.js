!function(){"use strict";function c(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function e(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}function f(o){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{},e=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(e=e.concat(Object.getOwnPropertySymbols(i).filter(function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable}))),e.forEach(function(t){var e,n,r;e=o,r=i[n=t],n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r})}return o}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function i(t,e){return(i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function o(t,e,n){return(o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var o=new(Function.bind.apply(t,r));return n&&i(o,n.prototype),o}).apply(null,arguments)}function n(t){var r="function"==typeof Map?new Map:void 0;return(n=function(t){if(null===t||(e=t,-1===Function.toString.call(e).indexOf("[native code]")))return t;var e;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(t))return r.get(t);r.set(t,n)}function n(){return o(t,arguments,u(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),i(n,t)})(t)}function l(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function a(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){o=!0,i=t}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var d={CONTINUE:100,OK:200,INTERNAL_ERROR:400,ALREADY_PERSONALIZED:401,PASSWORD_MISMATCH:402,PASSWORD_LOCKOUT:403,WRONG_KEY:404,WRONG_KEY_SECOND:405,NOT_A_KEY:406,NOT_A_KEY_SECOND:407,KEY_DISABLED:408,NOT_ALLOWED:409,BLANK_TOKEN:410,BLANK_SECOND_TOKEN:411,ACTIVITY_PROFILE_LOCKED:412,SSL_REQUIRED:413,BLANK_NORMAL_TOKEN:414,BLANK_SECOND_NORMAL_TOKEN:415,BLANK_MASTER_TOKEN:416,BLANK_SECOND_MASTER_TOKEN:417,NOT_ACTIVATED_TOKEN:418,NOT_ACTIVATED_SECOND_TOKEN:419,WRONG_KEY_SET:420,NO_VERIFIER:421,INCOMPLETE_KEYSET:422,INVALID_TICKET:423,SAME_TOKEN:424,NO_RECOVERY_INFO:425,BAD_RECOVERY_REQUEST:426,RECOVERY_FAILED:427,TERMINAL_ERROR:500,TERMINAL_NOT_FOUND:501,TERMINAL_BAD_REQUEST:502,NO_CONNECTION:503,NETWORK_ERROR:504,PROTOCOL_ERROR:505,UNKNOWN_HANDLER:506,TERMINAL_CANCELED:590,TIMEOUT:600,TICKET_TIMEOUT:601,USER_REJECT:603,NO_AUTH_INTERFACES_FOUND:604,TERMINAL_TIMEOUT:605,UNSUPPORTED_PLATFORM:606},s="No WWPass SecurityPack is found on your computer or WWPass Browser Plugin is disabled",h=[],p=function(t){return new Promise(function(n,r){var o=f({},{ppx:"wwp_",version:2,ticket:void 0,callbackURL:void 0,returnErrors:!1,log:function(){},development:!1,spfewsAddress:"wss://spfews.wwpass.com",echo:void 0},t),i=null,a=o.ticket,s=null,c=function(t,e){200===t?n({ppx:o.ppx,version:o.version,status:t,reason:"OK",ticket:o.ticket,callbackURL:o.callbackURL,clientKey:i,originalTicket:a,ttl:s}):r({ppx:o.ppx,version:o.version,status:t,reason:e,ticket:o.ticket,callbackURL:o.callbackURL})};if("WebSocket"in window){var e=o.spfewsAddress,u=new WebSocket(e);h.push(u);var l=o.log;u.onopen=function(){try{l("Connected: ".concat(e));var t=JSON.stringify({ticket:o.ticket});l("Sent message to server: ".concat(t)),u.send(t)}catch(t){l(t),c(d.INTERNAL_ERROR,"WebSocket error")}},u.onclose=function(){try{var t=h.indexOf(u);-1!==t&&h.splice(t,1),l("Disconnected"),n({refresh:!0})}catch(t){l(t),c(d.INTERNAL_ERROR,"WebSocket error")}},u.onmessage=function(t){try{l("Message received from server: ".concat(t.data));var e=JSON.parse(t.data),n=e.code,r=e.reason;if("clientKey"in e&&!i&&(i=e.clientKey,void 0!==e.originalTicket&&(a=e.originalTicket,s=e.ttl)),100===n)return;c(n,r),u.close()}catch(t){l(t),c(d.INTERNAL_ERROR,"WebSocket error")}}}else c(d.INTERNAL_ERROR,"WebSocket is not supported.")})},g=function(t){return btoa(String.fromCharCode.apply(null,new Uint8Array(t)))},v=function(t){for(var e=atob(t),n=new Uint8Array(e.length),r=0;r<e.length;r+=1)n[r]=e.charCodeAt(r);return n.buffer},w=function(t){return String.fromCharCode.apply(null,new Uint16Array(t))},y=function(t){for(var e=new ArrayBuffer(2*t.length),n=new Uint16Array(e),r=0,o=t.length;r<o;r+=1)n[r]=t.charCodeAt(r);return e},m=window.crypto||window.msCrypto,E=m?m.webkitSubtle||m.subtle:null,b=function(t){return g(t).replace(/\+/g,"-").replace(/[/]/g,".").replace(/=/g,"_")},R=function(t,e,n){return E.decrypt(t,e,n)},T=function(t,e,n,r,o){return E.importKey(t,e,n,r,o)},_=function(t){var e=a(t.split("@"),1)[0].split(":");if(e.length<3)return!1;return e[1].split("").some(function(t){return"c"===t})},A=function(t){if(t&&t.data){var e={ticket:t.data,ttl:t.ttl||120};return delete e.data,e}return t},C=function(t){function s(t){var e,n,r;c(this,s);for(var o=arguments.length,i=new Array(1<o?o-1:0),a=1;a<o;a++)i[a-1]=arguments[a];return n=this,e=!(r=u(s).call(this,i,s))||"object"!=typeof r&&"function"!=typeof r?l(n):r,Error.captureStackTrace(l(e),s),e.code=t,e}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&i(t,e)}(s,n(Error)),e(s,[{key:"toString",value:function(){return"".concat(this.name,"(").concat(this.code,"): ").concat(this.message)}}]),s}(),N=function(t){var e=y(t);return E.digest({name:"SHA-256"},e).then(function(t){return function(t){for(var e=[],n=new DataView(t),r=0;r<n.byteLength;r+=4){var o="00000000",i=(o+n.getUint32(r).toString(16)).slice(-o.length);e.push(i)}return e.join("")}(t)})},k=function(){var t,e,n=window.localStorage.getItem("wwpassNonce");if(!n)return[];try{return t=JSON.parse(n),e=window.Date.now(),t.filter(function(t){return t.deadline>e})}catch(t){throw window.localStorage.removeItem("wwpassNonce"),t}},L=function(t){window.localStorage.setItem("wwpassNonce",JSON.stringify(t))},P=function(t){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if(!E)throw new C(d.SSL_REQUIRED,"Client-side encryption requires https.");var o=k();return N(t).then(function(e){var t=o.find(function(t){return e===t.hash}),n=t&&t.key?v(t.key):void 0;return r&&n&&(t.deadline=window.Date.now()+1e3*r,L(o)),n})},I=function(e){var o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:120;if(!E)throw new C(d.SSL_REQUIRED,"Client-side encryption requires https.");return P(e).then(function(t){return t||E.generateKey({name:"AES-CBC",length:256},!0,["encrypt","decrypt"]).then(function(t){return e="raw",n=t,E.exportKey(e,n);var e,n}).then(function(r){return N(e).then(function(t){var e={hash:t,key:g(r),deadline:window.Date.now()+1e3*o},n=k();return n.push(e),L(n),r})})})},S=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:120;return _(t)?I(t,e):new Promise(function(t){t(void 0)})},U=new Uint8Array([176,178,97,142,156,31,45,30,81,210,85,14,202,203,86,240]),t=function(){function o(t,e){c(this,o),this.ivLen="AES-GCM"===e.name?12:16,"AES-GCM"===(this.algorithm=e).name&&Object.assign(this.algorithm,{tagLength:128}),this.clientKey=t}return e(o,[{key:"encryptArrayBuffer",value:function(t){var e,n=new Uint8Array(this.ivLen);e=n,m.getRandomValues(e);var r,o,i,a=this.algorithm;return Object.assign(a,{iv:n}),(r=a,o=this.clientKey,i=t,E.encrypt(r,o,i)).then(function(t){return function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var r=e.reduce(function(t,e){return t+e.byteLength},0),o=0,i=new Uint8Array(r);0<e.length;)i.set(new Uint8Array(e[0]),o),o+=e[0].byteLength,e.shift();return i.buffer}(n.buffer,t)})}},{key:"encryptString",value:function(t){return this.encryptArrayBuffer(y(t)).then(g)}},{key:"decryptArrayBuffer",value:function(t){var e=this.algorithm;return Object.assign(e,{iv:t.slice(0,this.ivLen)}),R(e,this.clientKey,t.slice(this.ivLen))}},{key:"decryptString",value:function(t){return this.decryptArrayBuffer(v(t)).then(w)}}],[{key:"getWWPassCrypto",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"AES-GCM",n=null,r={name:t,length:256};return p({ticket:e,clientKeyOnly:!0}).then(function(t){if(!t.clientKey)throw Error("No client key associated with the ticket ".concat(e));return n=t.clientKey,P(t.originalTicket?t.originalTicket:e,t.ttl)}).then(function(t){if(!t)throw new Error("No client key nonce associated with the ticket in this browser");return T("raw",t,{name:"AES-CBC"},!1,["encrypt","decrypt","wrapKey","unwrapKey"])}).then(function(t){return R({name:"AES-CBC",iv:U},t,v(n))}).then(function(t){return T("raw",t,r,!1,["encrypt","decrypt","wrapKey","unwrapKey"])}).then(function(t){return new o(t,r)}).catch(function(t){if(void 0!==t.reason)throw new Error(t.reason);throw t})}}]),o}(),O={pragma:"no-cache","cache-control":"no-cache"},x=function(e){return fetch(e,{cache:"no-store",headers:O}).then(function(t){if(!t.ok)throw Error('Error fetching ticket from "'.concat(e,'": ').concat(t.statusText));return t.json()})},B=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n=f({},{universal:!1,operation:"auth",ppx:"wwp_",version:2,ticket:void 0,callbackURL:void 0,clientKey:void 0},t),r=n.universal?"https://get.wwpass.com/":"wwpass://";return"auth"===n.operation?(r+="auth",r+="?v=".concat(n.version),r+="&t=".concat(encodeURIComponent(n.ticket)),r+="&ppx=".concat(encodeURIComponent(n.ppx)),n.clientKey&&(r+="&ck=".concat(n.clientKey)),n.callbackURL&&e&&(r+="&c=".concat(encodeURIComponent(n.callbackURL)))):r+="".concat(encodeURIComponent(n.operation),"?t=").concat(encodeURIComponent(n.ticket)),r},M=function(t){window.location.href=function(){var t=f({},{ppx:"wwp_",version:2,status:200,reason:"OK",ticket:void 0,callbackURL:void 0,hw:!1},0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}),e=t.callbackURL,n=-1===e.indexOf("?")?"?":"&";return e+="".concat(n+encodeURIComponent(t.ppx),"version=").concat(t.version),e+="&".concat(encodeURIComponent(t.ppx),"ticket=").concat(encodeURIComponent(t.ticket)),e+="&".concat(encodeURIComponent(t.ppx),"status=").concat(encodeURIComponent(t.status)),e+="&".concat(encodeURIComponent(t.ppx),"reason=").concat(encodeURIComponent(t.reason)),t.hw&&(e+="&".concat(encodeURIComponent(t.ppx),"hw=1")),e}(t)};function K(t,e){return t(e={exports:{}},e.exports),e.exports}var D={}.toString,W=Array.isArray||function(t){return"[object Array]"==D.call(t)},F=2147483647;function H(t,e,n){return"number"==typeof t?Y(t):function(t,e,n){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');if("undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer)return function(t,e,n){if(e<0||t.byteLength<e)throw new RangeError("'offset' is out of bounds");if(t.byteLength<e+(n||0))throw new RangeError("'length' is out of bounds");var r;r=void 0===e&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,e):new Uint8Array(t,e,n);return r.__proto__=H.prototype,r}(t,e,n);return"string"!=typeof t?function(t){if(H.isBuffer(t)){var e=0|j(t.length),n=q(e);return 0===n.length||t.copy(n,0,0,e),n}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(r=t.length)!=r?q(0):V(t);if("Buffer"===t.type&&Array.isArray(t.data))return V(t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t):(r=t,o=0|J(r),i=q(o),a=i.write(r),a!==o&&(i=i.slice(0,a)),i);var r,o,i,a}(t,e,n)}function j(t){if(F<=t)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+F.toString(16)+" bytes");return 0|t}function q(t){var e=new Uint8Array(t);return e.__proto__=H.prototype,e}function Y(t){return q(t<0?0:0|j(t))}function V(t){for(var e=t.length<0?0:0|j(t.length),n=q(e),r=0;r<e;r+=1)n[r]=255&t[r];return n}function z(t,e){var n;e=e||1/0;for(var r=t.length,o=null,i=[],a=0;a<r;++a){if(55295<(n=t.charCodeAt(a))&&n<57344){if(!o){if(56319<n){-1<(e-=3)&&i.push(239,191,189);continue}if(a+1===r){-1<(e-=3)&&i.push(239,191,189);continue}o=n;continue}if(n<56320){-1<(e-=3)&&i.push(239,191,189),o=n;continue}n=65536+(o-55296<<10|n-56320)}else o&&-1<(e-=3)&&i.push(239,191,189);if(o=null,n<128){if((e-=1)<0)break;i.push(n)}else if(n<2048){if((e-=2)<0)break;i.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;i.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;i.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return i}function J(t){return H.isBuffer(t)?t.length:"undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer)?t.byteLength:("string"!=typeof t&&(t=""+t),0===t.length?0:z(t).length)}H.prototype.__proto__=Uint8Array.prototype,H.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&H[Symbol.species]===H&&Object.defineProperty(H,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),H.prototype.write=function(t,e,n){void 0===e?(n=this.length,e=0):void 0===n&&"string"==typeof e?(n=this.length,e=0):isFinite(e)&&(e|=0,isFinite(n)?n|=0:n=void 0);var r,o,i,a=this.length-e;if((void 0===n||a<n)&&(n=a),0<t.length&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");return o=e,i=n,function(t,e,n,r){for(var o=0;o<r&&!(o+n>=e.length||o>=t.length);++o)e[o+n]=t[o];return o}(z(t,(r=this).length-o),r,o,i)},H.prototype.slice=function(t,e){var n=this.length;(t=~~t)<0?(t+=n)<0&&(t=0):n<t&&(t=n),(e=void 0===e?n:~~e)<0?(e+=n)<0&&(e=0):n<e&&(e=n),e<t&&(e=t);var r=this.subarray(t,e);return r.__proto__=H.prototype,r},H.prototype.copy=function(t,e,n,r){if(n||(n=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),0<r&&r<n&&(r=n),r===n)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-n&&(r=t.length-e+n);var o,i=r-n;if(this===t&&n<e&&e<r)for(o=i-1;0<=o;--o)t[o+e]=this[o+n];else if(i<1e3)for(o=0;o<i;++o)t[o+e]=this[o+n];else Uint8Array.prototype.set.call(t,this.subarray(n,n+i),e);return i},H.prototype.fill=function(t,e,n){if("string"==typeof t){if("string"==typeof e?(e=0,n=this.length):"string"==typeof n&&(n=this.length),1===t.length){var r=t.charCodeAt(0);r<256&&(t=r)}}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<n)throw new RangeError("Out of range index");if(n<=e)return this;var o;if(e>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0),"number"==typeof t)for(o=e;o<n;++o)this[o]=t;else{var i=H.isBuffer(t)?t:new H(t),a=i.length;for(o=0;o<n-e;++o)this[o+e]=i[o%a]}return this},H.concat=function(t,e){if(!W(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return q(null);var n;if(void 0===e)for(n=e=0;n<t.length;++n)e+=t[n].length;var r=Y(e),o=0;for(n=0;n<t.length;++n){var i=t[n];if(!H.isBuffer(i))throw new TypeError('"list" argument must be an Array of Buffers');i.copy(r,o),o+=i.length}return r},H.byteLength=J,H.prototype._isBuffer=!0,H.isBuffer=function(t){return!(null==t||!t._isBuffer)};var Q,G=H,$=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706],Z={getSymbolSize:function(t){if(!t)throw new Error('"version" cannot be null or undefined');if(t<1||40<t)throw new Error('"version" should be in range from 1 to 40');return 4*t+17},getSymbolTotalCodewords:function(t){return $[t]},getBCHDigit:function(t){for(var e=0;0!==t;)e++,t>>>=1;return e},setToSJISFunction:function(t){if("function"!=typeof t)throw new Error('"toSJISFunc" is not a valid function.');Q=t},isKanjiModeEnabled:function(){return void 0!==Q},toSJIS:function(t){return Q(t)}},X=K(function(t,n){n.L={bit:1},n.M={bit:0},n.Q={bit:3},n.H={bit:2},n.isValid=function(t){return t&&void 0!==t.bit&&0<=t.bit&&t.bit<4},n.from=function(t,e){if(n.isValid(t))return t;try{return function(t){if("string"!=typeof t)throw new Error("Param is not a string");switch(t.toLowerCase()){case"l":case"low":return n.L;case"m":case"medium":return n.M;case"q":case"quartile":return n.Q;case"h":case"high":return n.H;default:throw new Error("Unknown EC Level: "+t)}}(t)}catch(t){return e}}});X.L,X.M,X.Q,X.H,X.isValid;function tt(){this.buffer=[],this.length=0}tt.prototype={get:function(t){var e=Math.floor(t/8);return 1==(this.buffer[e]>>>7-t%8&1)},put:function(t,e){for(var n=0;n<e;n++)this.putBit(1==(t>>>e-n-1&1))},getLengthInBits:function(){return this.length},putBit:function(t){var e=Math.floor(this.length/8);this.buffer.length<=e&&this.buffer.push(0),t&&(this.buffer[e]|=128>>>this.length%8),this.length++}};var et=tt;function nt(t){if(!t||t<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=t,this.data=new G(t*t),this.data.fill(0),this.reservedBit=new G(t*t),this.reservedBit.fill(0)}nt.prototype.set=function(t,e,n,r){var o=t*this.size+e;this.data[o]=n,r&&(this.reservedBit[o]=!0)},nt.prototype.get=function(t,e){return this.data[t*this.size+e]},nt.prototype.xor=function(t,e,n){this.data[t*this.size+e]^=n},nt.prototype.isReserved=function(t,e){return this.reservedBit[t*this.size+e]};var rt=nt,ot=K(function(t,a){var s=Z.getSymbolSize;a.getRowColCoords=function(t){if(1===t)return[];for(var e=Math.floor(t/7)+2,n=s(t),r=145===n?26:2*Math.ceil((n-13)/(2*e-2)),o=[n-7],i=1;i<e-1;i++)o[i]=o[i-1]-r;return o.push(6),o.reverse()},a.getPositions=function(t){for(var e=[],n=a.getRowColCoords(t),r=n.length,o=0;o<r;o++)for(var i=0;i<r;i++)0===o&&0===i||0===o&&i===r-1||o===r-1&&0===i||e.push([n[o],n[i]]);return e}}),it=(ot.getRowColCoords,ot.getPositions,Z.getSymbolSize),at={getPositions:function(t){var e=it(t);return[[0,0],[e-7,0],[0,e-7]]}},st=K(function(t,s){s.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};var l=3,a=3,c=40,o=10;function i(t,e,n){switch(t){case s.Patterns.PATTERN000:return(e+n)%2==0;case s.Patterns.PATTERN001:return e%2==0;case s.Patterns.PATTERN010:return n%3==0;case s.Patterns.PATTERN011:return(e+n)%3==0;case s.Patterns.PATTERN100:return(Math.floor(e/2)+Math.floor(n/3))%2==0;case s.Patterns.PATTERN101:return e*n%2+e*n%3==0;case s.Patterns.PATTERN110:return(e*n%2+e*n%3)%2==0;case s.Patterns.PATTERN111:return(e*n%3+(e+n)%2)%2==0;default:throw new Error("bad maskPattern:"+t)}}s.getPenaltyN1=function(t){for(var e=t.size,n=0,r=0,o=0,i=null,a=null,s=0;s<e;s++){r=o=0,i=a=null;for(var c=0;c<e;c++){var u=t.get(s,c);u===i?r++:(5<=r&&(n+=l+(r-5)),i=u,r=1),(u=t.get(c,s))===a?o++:(5<=o&&(n+=l+(o-5)),a=u,o=1)}5<=r&&(n+=l+(r-5)),5<=o&&(n+=l+(o-5))}return n},s.getPenaltyN2=function(t){for(var e=t.size,n=0,r=0;r<e-1;r++)for(var o=0;o<e-1;o++){var i=t.get(r,o)+t.get(r,o+1)+t.get(r+1,o)+t.get(r+1,o+1);4!==i&&0!==i||n++}return n*a},s.getPenaltyN3=function(t){for(var e=t.size,n=0,r=0,o=0,i=0;i<e;i++){r=o=0;for(var a=0;a<e;a++)r=r<<1&2047|t.get(i,a),10<=a&&(1488===r||93===r)&&n++,o=o<<1&2047|t.get(a,i),10<=a&&(1488===o||93===o)&&n++}return n*c},s.getPenaltyN4=function(t){for(var e=0,n=t.data.length,r=0;r<n;r++)e+=t.data[r];return Math.abs(Math.ceil(100*e/n/5)-10)*o},s.applyMask=function(t,e){for(var n=e.size,r=0;r<n;r++)for(var o=0;o<n;o++)e.isReserved(o,r)||e.xor(o,r,i(t,o,r))},s.getBestMask=function(t,e){for(var n=Object.keys(s.Patterns).length,r=0,o=1/0,i=0;i<n;i++){e(i),s.applyMask(i,t);var a=s.getPenaltyN1(t)+s.getPenaltyN2(t)+s.getPenaltyN3(t)+s.getPenaltyN4(t);s.applyMask(i,t),a<o&&(o=a,r=i)}return r}}),ct=(st.Patterns,st.getPenaltyN1,st.getPenaltyN2,st.getPenaltyN3,st.getPenaltyN4,st.applyMask,st.getBestMask,[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81]),ut=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430],lt={getBlocksCount:function(t,e){switch(e){case X.L:return ct[4*(t-1)+0];case X.M:return ct[4*(t-1)+1];case X.Q:return ct[4*(t-1)+2];case X.H:return ct[4*(t-1)+3];default:return}},getTotalCodewordsCount:function(t,e){switch(e){case X.L:return ut[4*(t-1)+0];case X.M:return ut[4*(t-1)+1];case X.Q:return ut[4*(t-1)+2];case X.H:return ut[4*(t-1)+3];default:return}}},ft=new G(512),dt=new G(256);!function(){for(var t=1,e=0;e<255;e++)ft[e]=t,dt[t]=e,256&(t<<=1)&&(t^=285);for(e=255;e<512;e++)ft[e]=ft[e-255]}();var ht=function(t){return ft[t]},pt=function(t,e){return 0===t||0===e?0:ft[dt[t]+dt[e]]},gt=K(function(t,r){r.mul=function(t,e){var n=new G(t.length+e.length-1);n.fill(0);for(var r=0;r<t.length;r++)for(var o=0;o<e.length;o++)n[r+o]^=pt(t[r],e[o]);return n},r.mod=function(t,e){for(var n=new G(t);0<=n.length-e.length;){for(var r=n[0],o=0;o<e.length;o++)n[o]^=pt(e[o],r);for(var i=0;i<n.length&&0===n[i];)i++;n=n.slice(i)}return n},r.generateECPolynomial=function(t){for(var e=new G([1]),n=0;n<t;n++)e=r.mul(e,[1,ht(n)]);return e}});gt.mul,gt.mod,gt.generateECPolynomial;function vt(t){this.genPoly=void 0,this.degree=t,this.degree&&this.initialize(this.degree)}vt.prototype.initialize=function(t){this.degree=t,this.genPoly=gt.generateECPolynomial(this.degree)},vt.prototype.encode=function(t){if(!this.genPoly)throw new Error("Encoder not initialized");var e=new G(this.degree);e.fill(0);var n=G.concat([t,e],t.length+this.degree),r=gt.mod(n,this.genPoly),o=this.degree-r.length;if(0<o){var i=new G(this.degree);return i.fill(0),r.copy(i,o),i}return r};var wt=vt,yt="(?:[　-〿]|[぀-ゟ]|[゠-ヿ]|[＀-￯]|[一-龯]|[★-☆]|[←-↕]|※|[‐―‘’‥…“”∥≠]|[Α-ё]|[§¨±´×÷])+",mt=new RegExp(yt,"g"),Et=new RegExp("[^A-Z0-9 $%*+-./:]+","g"),bt=new RegExp("(?:(?![A-Z0-9 $%*+-./:]|(?:[　-〿]|[぀-ゟ]|[゠-ヿ]|[＀-￯]|[一-龯]|[★-☆]|[←-↕]|※|[‐―‘’‥…“”∥≠]|[Α-ё]|[§¨±´×÷])+).)+","g"),Rt=new RegExp("[0-9]+","g"),Tt=new RegExp("[A-Z $%*+-./:]+","g"),_t=new RegExp("^"+yt+"$"),At=new RegExp("^[0-9]+$"),Ct=new RegExp("^[A-Z0-9 $%*+-./:]+$"),Nt={KANJI:mt,BYTE_KANJI:Et,BYTE:bt,NUMERIC:Rt,ALPHANUMERIC:Tt,testKanji:function(t){return _t.test(t)},testNumeric:function(t){return At.test(t)},testAlphanumeric:function(t){return Ct.test(t)}},kt=K(function(t,n){n.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},n.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},n.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},n.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},n.MIXED={bit:-1},n.getCharCountIndicator=function(t,e){if(!t.ccBits)throw new Error("Invalid mode: "+t);if(!Lt.isValid(e))throw new Error("Invalid version: "+e);return 1<=e&&e<10?t.ccBits[0]:e<27?t.ccBits[1]:t.ccBits[2]},n.getBestModeForData=function(t){return Nt.testNumeric(t)?n.NUMERIC:Nt.testAlphanumeric(t)?n.ALPHANUMERIC:Nt.testKanji(t)?n.KANJI:n.BYTE},n.toString=function(t){if(t&&t.id)return t.id;throw new Error("Invalid mode")},n.isValid=function(t){return t&&t.bit&&t.ccBits},n.from=function(t,e){if(n.isValid(t))return t;try{return function(t){if("string"!=typeof t)throw new Error("Param is not a string");switch(t.toLowerCase()){case"numeric":return n.NUMERIC;case"alphanumeric":return n.ALPHANUMERIC;case"kanji":return n.KANJI;case"byte":return n.BYTE;default:throw new Error("Unknown mode: "+t)}}(t)}catch(t){return e}}}),Lt=(kt.NUMERIC,kt.ALPHANUMERIC,kt.BYTE,kt.KANJI,kt.MIXED,kt.getCharCountIndicator,kt.getBestModeForData,kt.isValid,K(function(t,i){var n=Z.getBCHDigit(7973);function a(t,e){return kt.getCharCountIndicator(t,e)+4}function o(t,n){var r=0;return t.forEach(function(t){var e=a(t.mode,n);r+=e+t.getBitsLength()}),r}i.isValid=function(t){return!isNaN(t)&&1<=t&&t<=40},i.from=function(t,e){return i.isValid(t)?parseInt(t,10):e},i.getCapacity=function(t,e,n){if(!i.isValid(t))throw new Error("Invalid QR Code version");void 0===n&&(n=kt.BYTE);var r=8*(Z.getSymbolTotalCodewords(t)-lt.getTotalCodewordsCount(t,e));if(n===kt.MIXED)return r;var o=r-a(n,t);switch(n){case kt.NUMERIC:return Math.floor(o/10*3);case kt.ALPHANUMERIC:return Math.floor(o/11*2);case kt.KANJI:return Math.floor(o/13);case kt.BYTE:default:return Math.floor(o/8)}},i.getBestVersionForData=function(t,e){var n,r=X.from(e,X.M);if(W(t)){if(1<t.length)return function(t,e){for(var n=1;n<=40;n++)if(o(t,n)<=i.getCapacity(n,e,kt.MIXED))return n}(t,r);if(0===t.length)return 1;n=t[0]}else n=t;return function(t,e,n){for(var r=1;r<=40;r++)if(e<=i.getCapacity(r,n,t))return r}(n.mode,n.getLength(),r)},i.getEncodedBits=function(t){if(!i.isValid(t)||t<7)throw new Error("Invalid QR Code version");for(var e=t<<12;0<=Z.getBCHDigit(e)-n;)e^=7973<<Z.getBCHDigit(e)-n;return t<<12|e}})),Pt=(Lt.isValid,Lt.getCapacity,Lt.getBestVersionForData,Lt.getEncodedBits,Z.getBCHDigit(1335)),It={getEncodedBits:function(t,e){for(var n=t.bit<<3|e,r=n<<10;0<=Z.getBCHDigit(r)-Pt;)r^=1335<<Z.getBCHDigit(r)-Pt;return 21522^(n<<10|r)}};function St(t){this.mode=kt.NUMERIC,this.data=t.toString()}St.getBitsLength=function(t){return 10*Math.floor(t/3)+(t%3?t%3*3+1:0)},St.prototype.getLength=function(){return this.data.length},St.prototype.getBitsLength=function(){return St.getBitsLength(this.data.length)},St.prototype.write=function(t){var e,n,r;for(e=0;e+3<=this.data.length;e+=3)n=this.data.substr(e,3),r=parseInt(n,10),t.put(r,10);var o=this.data.length-e;0<o&&(n=this.data.substr(e),r=parseInt(n,10),t.put(r,3*o+1))};var Ut=St,Ot=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function xt(t){this.mode=kt.ALPHANUMERIC,this.data=t}xt.getBitsLength=function(t){return 11*Math.floor(t/2)+t%2*6},xt.prototype.getLength=function(){return this.data.length},xt.prototype.getBitsLength=function(){return xt.getBitsLength(this.data.length)},xt.prototype.write=function(t){var e;for(e=0;e+2<=this.data.length;e+=2){var n=45*Ot.indexOf(this.data[e]);n+=Ot.indexOf(this.data[e+1]),t.put(n,11)}this.data.length%2&&t.put(Ot.indexOf(this.data[e]),6)};var Bt=xt;function Mt(t){this.mode=kt.BYTE,this.data=new G(t)}Mt.getBitsLength=function(t){return 8*t},Mt.prototype.getLength=function(){return this.data.length},Mt.prototype.getBitsLength=function(){return Mt.getBitsLength(this.data.length)},Mt.prototype.write=function(t){for(var e=0,n=this.data.length;e<n;e++)t.put(this.data[e],8)};var Kt=Mt;function Dt(t){this.mode=kt.KANJI,this.data=t}Dt.getBitsLength=function(t){return 13*t},Dt.prototype.getLength=function(){return this.data.length},Dt.prototype.getBitsLength=function(){return Dt.getBitsLength(this.data.length)},Dt.prototype.write=function(t){var e;for(e=0;e<this.data.length;e++){var n=Z.toSJIS(this.data[e]);if(33088<=n&&n<=40956)n-=33088;else{if(!(57408<=n&&n<=60351))throw new Error("Invalid SJIS character: "+this.data[e]+"\nMake sure your charset is UTF-8");n-=49472}n=192*(n>>>8&255)+(255&n),t.put(n,13)}};var Wt=Dt,Ft=K(function(t){var p={single_source_shortest_paths:function(t,e,n){var r={},o={};o[e]=0;var i,a,s,c,u,l,f,d=p.PriorityQueue.make();for(d.push(e,0);!d.empty();)for(s in a=(i=d.pop()).value,c=i.cost,u=t[a]||{})u.hasOwnProperty(s)&&(l=c+u[s],f=o[s],(void 0===o[s]||l<f)&&(o[s]=l,d.push(s,l),r[s]=a));if(void 0===n||void 0!==o[n])return r;var h=["Could not find a path from ",e," to ",n,"."].join("");throw new Error(h)},extract_shortest_path_from_predecessor_list:function(t,e){for(var n=[],r=e;r;)n.push(r),t[r],r=t[r];return n.reverse(),n},find_path:function(t,e,n){var r=p.single_source_shortest_paths(t,e,n);return p.extract_shortest_path_from_predecessor_list(r,n)},PriorityQueue:{make:function(t){var e,n=p.PriorityQueue,r={};for(e in t=t||{},n)n.hasOwnProperty(e)&&(r[e]=n[e]);return r.queue=[],r.sorter=t.sorter||n.default_sorter,r},default_sorter:function(t,e){return t.cost-e.cost},push:function(t,e){var n={value:t,cost:e};this.queue.push(n),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return 0===this.queue.length}}};t.exports=p}),Ht=K(function(t,a){function s(t){return unescape(encodeURIComponent(t)).length}function i(t,e,n){for(var r,o=[];null!==(r=t.exec(n));)o.push({data:r[0],index:r.index,mode:e,length:r[0].length});return o}function c(t){var e,n,r=i(Nt.NUMERIC,kt.NUMERIC,t),o=i(Nt.ALPHANUMERIC,kt.ALPHANUMERIC,t);return n=Z.isKanjiModeEnabled()?(e=i(Nt.BYTE,kt.BYTE,t),i(Nt.KANJI,kt.KANJI,t)):(e=i(Nt.BYTE_KANJI,kt.BYTE,t),[]),r.concat(o,e,n).sort(function(t,e){return t.index-e.index}).map(function(t){return{data:t.data,mode:t.mode,length:t.length}})}function h(t,e){switch(e){case kt.NUMERIC:return Ut.getBitsLength(t);case kt.ALPHANUMERIC:return Bt.getBitsLength(t);case kt.KANJI:return Wt.getBitsLength(t);case kt.BYTE:return Kt.getBitsLength(t)}}function n(t,e){var n,r=kt.getBestModeForData(t);if((n=kt.from(e,r))!==kt.BYTE&&n.bit<r.bit)throw new Error('"'+t+'" cannot be encoded with mode '+kt.toString(n)+".\n Suggested mode is: "+kt.toString(r));switch(n!==kt.KANJI||Z.isKanjiModeEnabled()||(n=kt.BYTE),n){case kt.NUMERIC:return new Ut(t);case kt.ALPHANUMERIC:return new Bt(t);case kt.KANJI:return new Wt(t);case kt.BYTE:return new Kt(t)}}a.fromArray=function(t){return t.reduce(function(t,e){return"string"==typeof e?t.push(n(e,null)):e.data&&t.push(n(e.data,e.mode)),t},[])},a.fromString=function(t,e){for(var n=function(t,e){for(var n={},r={start:{}},o=["start"],i=0;i<t.length;i++){for(var a=t[i],s=[],c=0;c<a.length;c++){var u=a[c],l=""+i+c;s.push(l),n[l]={node:u,lastCount:0},r[l]={};for(var f=0;f<o.length;f++){var d=o[f];n[d]&&n[d].node.mode===u.mode?(r[d][l]=h(n[d].lastCount+u.length,u.mode)-h(n[d].lastCount,u.mode),n[d].lastCount+=u.length):(n[d]&&(n[d].lastCount=u.length),r[d][l]=h(u.length,u.mode)+4+kt.getCharCountIndicator(u.mode,e))}}o=s}for(f=0;f<o.length;f++)r[o[f]].end=0;return{map:r,table:n}}(function(t){for(var e=[],n=0;n<t.length;n++){var r=t[n];switch(r.mode){case kt.NUMERIC:e.push([r,{data:r.data,mode:kt.ALPHANUMERIC,length:r.length},{data:r.data,mode:kt.BYTE,length:r.length}]);break;case kt.ALPHANUMERIC:e.push([r,{data:r.data,mode:kt.BYTE,length:r.length}]);break;case kt.KANJI:e.push([r,{data:r.data,mode:kt.BYTE,length:s(r.data)}]);break;case kt.BYTE:e.push([{data:r.data,mode:kt.BYTE,length:s(r.data)}])}}return e}(c(t,Z.isKanjiModeEnabled())),e),r=Ft.find_path(n.map,"start","end"),o=[],i=1;i<r.length-1;i++)o.push(n.table[r[i]].node);return a.fromArray(o.reduce(function(t,e){var n=0<=t.length-1?t[t.length-1]:null;return n&&n.mode===e.mode?t[t.length-1].data+=e.data:t.push(e),t},[]))},a.rawSplit=function(t){return a.fromArray(c(t,Z.isKanjiModeEnabled()))}});Ht.fromArray,Ht.fromString,Ht.rawSplit;function jt(t,e,n){var r,o,i=t.size,a=It.getEncodedBits(e,n);for(r=0;r<15;r++)o=1==(a>>r&1),r<6?t.set(r,8,o,!0):r<8?t.set(r+1,8,o,!0):t.set(i-15+r,8,o,!0),r<8?t.set(8,i-r-1,o,!0):r<9?t.set(8,15-r-1+1,o,!0):t.set(8,15-r-1,o,!0);t.set(i-8,8,1,!0)}function qt(e,t,n){var r=new et;n.forEach(function(t){r.put(t.mode.bit,4),r.put(t.getLength(),kt.getCharCountIndicator(t.mode,e)),t.write(r)});var o=8*(Z.getSymbolTotalCodewords(e)-lt.getTotalCodewordsCount(e,t));for(r.getLengthInBits()+4<=o&&r.put(0,4);r.getLengthInBits()%8!=0;)r.putBit(0);for(var i=(o-r.getLengthInBits())/8,a=0;a<i;a++)r.put(a%2?17:236,8);return function(t,e,n){for(var r=Z.getSymbolTotalCodewords(e),o=lt.getTotalCodewordsCount(e,n),i=r-o,a=lt.getBlocksCount(e,n),s=a-r%a,c=Math.floor(r/a),u=Math.floor(i/a),l=u+1,f=c-u,d=new wt(f),h=0,p=new Array(a),g=new Array(a),v=0,w=new G(t.buffer),y=0;y<a;y++){var m=y<s?u:l;p[y]=w.slice(h,h+m),g[y]=d.encode(p[y]),h+=m,v=Math.max(v,m)}var E,b,R=new G(r),T=0;for(E=0;E<v;E++)for(b=0;b<a;b++)E<p[b].length&&(R[T++]=p[b][E]);for(E=0;E<f;E++)for(b=0;b<a;b++)R[T++]=g[b][E];return R}(r,e,t)}function Yt(t,e,n){var r;if(W(t))r=Ht.fromArray(t);else{if("string"!=typeof t)throw new Error("Invalid data");var o=e;if(!o){var i=Ht.rawSplit(t);o=Lt.getBestVersionForData(i,n)}r=Ht.fromString(t,o)}var a=Lt.getBestVersionForData(r,n);if(!a)throw new Error("The amount of data is too big to be stored in a QR Code");if(e){if(e<a)throw new Error("\nThe chosen QR Code version cannot contain this amount of data.\nMinimum version required to store current data is: "+a+".\n")}else e=a;var s=qt(e,n,r),c=Z.getSymbolSize(e),u=new rt(c);!function(t,e){for(var n=t.size,r=at.getPositions(e),o=0;o<r.length;o++)for(var i=r[o][0],a=r[o][1],s=-1;s<=7;s++)if(!(i+s<=-1||n<=i+s))for(var c=-1;c<=7;c++)a+c<=-1||n<=a+c||(0<=s&&s<=6&&(0===c||6===c)||0<=c&&c<=6&&(0===s||6===s)||2<=s&&s<=4&&2<=c&&c<=4?t.set(i+s,a+c,!0,!0):t.set(i+s,a+c,!1,!0))}(u,e),function(t){for(var e=t.size,n=8;n<e-8;n++){var r=n%2==0;t.set(n,6,r,!0),t.set(6,n,r,!0)}}(u),function(t,e){for(var n=ot.getPositions(e),r=0;r<n.length;r++)for(var o=n[r][0],i=n[r][1],a=-2;a<=2;a++)for(var s=-2;s<=2;s++)-2===a||2===a||-2===s||2===s||0===a&&0===s?t.set(o+a,i+s,!0,!0):t.set(o+a,i+s,!1,!0)}(u,e),jt(u,n,0),7<=e&&function(t,e){for(var n,r,o,i=t.size,a=Lt.getEncodedBits(e),s=0;s<18;s++)n=Math.floor(s/3),r=s%3+i-8-3,o=1==(a>>s&1),t.set(n,r,o,!0),t.set(r,n,o,!0)}(u,e),function(t,e){for(var n=t.size,r=-1,o=n-1,i=7,a=0,s=n-1;0<s;s-=2)for(6===s&&s--;;){for(var c=0;c<2;c++)if(!t.isReserved(o,s-c)){var u=!1;a<e.length&&(u=1==(e[a]>>>i&1)),t.set(o,s-c,u),-1==--i&&(a++,i=7)}if((o+=r)<0||n<=o){o-=r,r=-r;break}}}(u,s);var l=st.getBestMask(u,jt.bind(null,u,n));return st.applyMask(l,u),jt(u,n,l),{modules:u,version:e,errorCorrectionLevel:n,maskPattern:l,segments:r}}var Vt=function(t,e){if(void 0===t||""===t)throw new Error("No input text");var n,r=X.M;return void 0!==e&&(r=X.from(e.errorCorrectionLevel,X.M),n=Lt.from(e.version),e.toSJISFunc&&Z.setToSJISFunction(e.toSJISFunc)),Yt(t,n,r)};function zt(t){if("string"!=typeof t)throw new Error("Color should be defined as hex string");var e=t.slice().replace("#","").split("");if(e.length<3||5===e.length||8<e.length)throw new Error("Invalid hex color: "+t);3!==e.length&&4!==e.length||(e=Array.prototype.concat.apply([],e.map(function(t){return[t,t]}))),6===e.length&&e.push("F","F");var n=parseInt(e.join(""),16);return{r:n>>24&255,g:n>>16&255,b:n>>8&255,a:255&n}}var Jt=function(t){t||(t={}),t.color||(t.color={});var e=void 0===t.margin||null===t.margin||t.margin<0?4:t.margin;return{scale:t.scale||4,margin:e,color:{dark:zt(t.color.dark||"#000000ff"),light:zt(t.color.light||"#ffffffff")},type:t.type,rendererOpts:t.rendererOpts||{}}},Qt=function(t,e,n,r,o){for(var i=e.modules.size,a=e.modules.data,s=n*r,c=i*r+2*s,u=[o.light,o.dark],l=0;l<c;l++)for(var f=0;f<c;f++){var d=4*(l*c+f),h=o.light;s<=l&&s<=f&&l<c-s&&f<c-s&&(h=u[a[Math.floor((l-s)/r)*i+Math.floor((f-s)/r)]]),t[d++]=h.r,t[d++]=h.g,t[d++]=h.b,t[d]=h.a}},Gt=K(function(t,s){s.render=function(t,e,n){var r=n,o=e;void 0!==r||e&&e.getContext||(r=e,e=void 0),e||(o=function(){try{return document.createElement("canvas")}catch(t){throw new Error("You need to specify a canvas element")}}()),r=Jt(r);var i,a,s=(t.modules.size+2*r.margin)*r.scale,c=o.getContext("2d"),u=c.createImageData(s,s);return Qt(u.data,t,r.margin,r.scale,r.color),i=o,a=s,c.clearRect(0,0,i.width,i.height),i.style||(i.style={}),i.height=a,i.width=a,i.style.height=a+"px",i.style.width=a+"px",c.putImageData(u,0,0),o},s.renderToDataURL=function(t,e,n){var r=n;void 0!==r||e&&e.getContext||(r=e,e=void 0),r||(r={});var o=s.render(t,e,r),i=r.type||"image/png",a=r.rendererOpts||{};return o.toDataURL(i,a.quality)}});Gt.render,Gt.renderToDataURL;function $t(t){return'fill="rgb('+[t.r,t.g,t.b].join(",")+')" fill-opacity="'+(t.a/255).toFixed(2)+'"'}var Zt,Xt=function(t,e){var n=Jt(e),r=t.modules.size,o=t.modules.data,i=(r+2*n.margin)*n.scale,a='<?xml version="1.0" encoding="utf-8"?>\n';a+='<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n',a+='<svg version="1.1" baseProfile="full"',a+=' width="'+i+'" height="'+i+'"',a+=' viewBox="0 0 '+i+" "+i+'"',a+=' xmlns="http://www.w3.org/2000/svg"',a+=' xmlns:xlink="http://www.w3.org/1999/xlink"',a+=' xmlns:ev="http://www.w3.org/2001/xml-events">\n',a+='<rect x="0" y="0" width="'+i+'" height="'+i+'" '+$t(n.color.light)+" />\n",a+='<defs><rect id="p" width="'+n.scale+'" height="'+n.scale+'" /></defs>\n',a+="<g "+$t(n.color.dark)+">\n";for(var s=0;s<r;s++)for(var c=0;c<r;c++)o[s*r+c]&&(a+='<use x="'+(n.margin+c)*n.scale+'" y="'+(n.margin+s)*n.scale+'" xlink:href="#p" />\n');return a+="</g>\n",a+="</svg>"},te=K(function(t,e){function n(t,e,n,r,o){var i=arguments.length-1;if(i<2)throw new Error("Too few arguments provided");if(2===i?(o=n,n=e,e=r=void 0):3===i&&(e.getContext&&void 0===o?(o=r,r=void 0):(o=r,r=n,n=e,e=void 0)),"function"!=typeof o)throw new Error("Callback required as last argument");try{o(null,t(Vt(n,r),e,r))}catch(t){o(t)}}e.create=Vt,e.toCanvas=n.bind(null,Gt.render),e.toDataURL=n.bind(null,Gt.renderToDataURL),e.toString=n.bind(null,function(t,e,n){return Xt(t,n)}),e.qrcodedraw=function(){return{draw:e.toCanvas}}}),ee=(te.create,te.toCanvas,te.toDataURL,te.qrcodedraw,function(t){for(;t.firstChild;)t.removeChild(t.firstChild)}),ne=!1,re=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"visible",n=null;return function(t){n=t,document.visibilityState===e?n():document.addEventListener("visibilitychange",function t(){document.visibilityState===e&&(n(),document.removeEventListener("visibilitychange",t))})}}(),oe=function(r,o,i,a){return new Promise(function(t){var e=document.createElement("canvas");if(te.toCanvas(e,B(o,!1),a||{},function(t){if(t)throw t}),a&&(e.className="".concat(a.prefix,"qrcode_canvas"),e.style.max_width="".concat(a.width,"px"),e.style.max_height="".concat(a.width,"px")),e.style.height="100%",e.style.width="100%",navigator&&("userAgent"in navigator&&navigator.userAgent.match(/iPhone|iPod|iPad|Android/i)||1<navigator.maxTouchPoints)&&!window.MSStream){var n=document.createElement("a");n.href=B(o),n.appendChild(e),n.addEventListener("click",function(){t({away:!0})}),e=n}ee(r),r.appendChild(e),setTimeout(function(){re(function(){t({refresh:!0})})},900*i)})},ie=function(t,e){return function(t,e){var n="".concat(e.prefix||"wwp_","qrcode_loader"),r=document.createElement("div");if(r.className=n,r.innerHTML='<div class="'.concat(n,'_blk"></div>\n  <div class="').concat(n,"_blk ").concat(n,'_delay"></div>\n  <div class="').concat(n,"_blk ").concat(n,'_delay"></div>\n  <div class="').concat(n,'_blk"></div>'),!ne){var o=document.createElement("style");o.innerHTML="@keyframes ".concat(e.prefix||"wwp_","pulse {\n      0%   { opacity: 1; }\n      100% { opacity: 0; }\n    }\n    .").concat(n," {\n      display: flex;\n      flex-direction: row;\n      flex-wrap: wrap;\n      justify-content: space-around;\n      align-items: center;\n      width: 30%;\n      height: 30%;\n      margin-left: 35%;\n      margin-top: 35%;\n    }\n    .").concat(n,"_blk {\n      height: 35%;\n      width: 35%;\n      animation: ").concat(e.prefix||"wwp_","pulse 0.75s ease-in infinite alternate;\n      background-color: #cccccc;\n    }\n    .").concat(n,"_delay {\n      animation-delay: 0.75s;\n    }"),document.getElementsByTagName("head")[0].appendChild(o),ne=!0}ee(t),t.appendChild(r)}(t,e)},ae=function e(n){var t={universal:!1,ticketURL:void 0,callbackURL:void 0,development:!1,version:2,ppx:"wwp_",spfewsAddress:"wss://spfews.wwpass.com",qrcodeStyle:{width:256,prefix:"wwp_"},log:function(){}},r=f({},t,n);r.qrcodeStyle=f({},t.qrcodeStyle,n.qrcodeStyle);var o=r.log;if(!r.ticketURL)throw Error("ticketURL not found");if(!r.callbackURL)throw Error("callbackURL not found");if(!r.qrcode)throw Error("Element not found");var i=null,a=null;return ie(r.qrcode,r.qrcodeStyle),x(r.ticketURL).then(function(t){var e=A(t);return i=e.ticket,a=e.ttl,S(i,a)}).then(function(t){var e={universal:r.universal,ticket:i,callbackURL:r.callbackURL,ppx:r.ppx,version:2,clientKey:t?b(t):void 0};return Promise.race([oe(r.qrcode,e,a,r.qrcodeStyle),p({callbackURL:r.callbackURL,ticket:i,log:o,development:r.development,version:r.version,ppx:r.ppx,spfewsAddress:r.spfewsAddress})])}).then(function(t){return ie(r.qrcode,r.qrcodeStyle),t.refresh?e(n):(t.clientKey&&r.catchClientKey&&r.catchClientKey(t.clientKey),t.away?(function(){for(;h.length;){var t=h.shift();t.readyState===WebSocket.OPEN&&t.close()}}(),{ppx:r.ppx,version:r.version,status:d.CONTINUE,reason:"User has clicked on QRCode",ticket:r.ticket,callbackURL:r.callbackURL}):(M(t),t))}).catch(function(t){if(!t.status)return o("QRCode auth error",t),function(t,e){var n=e instanceof C&&e.code===d.SSL_REQUIRED,r=void 0!==window.navigator.onLine&&!window.navigator.onLine,o=document.createElement("div");o.style.display="flex",o.style.alignItems="center",o.style.height="100%",o.style.width="100%";var i=document.createElement("div");i.style.margin="0 10%",i.style.width="80%",i.style.textAlign="center",i.style.overflow="hidden";var a="Error occured";n?a="Please use HTTPS":r&&(a="No internet connection"),i.innerHTML='<p style="margin:0; font-size: 1.2em; color: black;">'.concat(a,"</p>");var s=null;return n||((s=document.createElement("a")).textContent="Retry",s.style.fontWeight="400",s.style.fontFamily='"Arial", sans-serif',s.style.fontSize="1.2em",s.style.lineHeight="1.7em",s.style.cursor="pointer",s.href="#",i.appendChild(s)),o.appendChild(i),console.error("Error in WWPass Library: ".concat(e)),ee(t),t.appendChild(o),n?Promise.reject(e.message):new Promise(function(e){setTimeout(function(){e({refresh:!0})},6e4),s.addEventListener("click",function(t){e({refresh:!0}),t.preventDefault()}),r&&window.addEventListener("online",function(){return e({refresh:!0})})})}(r.qrcode,t).then(function(){return ie(r.qrcode,r.qrcodeStyle),new Promise(function(t){setTimeout(function(){t(e(n))},500)})});if(ie(r.qrcode,r.qrcodeStyle),t.status===d.INTERNAL_ERROR||r.returnErrors)M(t);else if(t.status===d.TICKET_TIMEOUT)return o("ticket timed out"),e(n);throw t})},se="https:"===window.location.protocol?"https:":"http:",ce="".concat(se,"//cdn.wwpass.com/packages/wwpass.js/2.4/wwpass.js.css"),ue=function(t){return"".concat("WWPass authentication is not supported on"," ").concat(t)},le=function(t,e,n){if(!document.getElementById("_wwpass_css")){var r=document.createElement("link");r.id="_wwpass_css",r.rel="stylesheet",r.href=ce,document.head.appendChild(r)}var o=document.createElement("div");o.id="_wwpass_err_dlg";var i=document.createElement("span");i.innerHTML="Close",i.id="_wwpass_err_close";var a=document.createElement("h1");a.innerHTML=e;var s=document.createElement("div");return s.innerHTML=t,o.appendChild(a),o.appendChild(s),o.appendChild(i),document.body.appendChild(o),document.getElementById("_wwpass_err_close").addEventListener("click",function(){var t=document.getElementById("_wwpass_err_dlg");return t.parentNode.removeChild(t),n(),!1}),!0},fe=function(t,e){if(t===d.NO_AUTH_INTERFACES_FOUND){var n=function(){var t=navigator.userAgent,e=/Firefox\/([0-9]+)\./,n=t.match(e);if(n&&1<n.length){var r=n[1];if(51<=Number(r))return"Firefox"}if(e=/Chrome\/([0-9]+)\./,(n=t.match(e))&&1<n.length){var o=n[1];if(45<=Number(o))return"Chrome"}return!1}(),r="";if(n){if("Chrome"===n){var o=encodeURIComponent(window.location.href);r="<p>The WWPass Authentication extension for Chrome is not installed or is disabled in browser settings.",r+="<p>Click the link below to install and enable the WWPass Authentication extension.",r+='<p><a href="https://chrome.wwpass.com/?callbackURL='.concat(o,'">Install WWPass Authentication Extension</a>')}else if("Firefox"===n){var i=encodeURIComponent(window.location.href);r="<p>The WWPass Authentication extension for Firefox is not installed or is disabled in browser settings.",r+="<p>Click the link below to install and enable the WWPass Authentication extension.",r+='<p><a href="https://firefox.wwpass.com/?callbackURL='.concat(i,'">Install WWPass Authentication Extension</a>')}}else r='<p>No Security Pack is found on your computer or WWPass&nbsp;Browser&nbsp;Plugin is disabled.</p><p>To install Security Pack visit <a href="https://ks.wwpass.com/download/">Key Services</a> or check plugin settings of your browser to activate WWPass&nbsp;Browser&nbsp;Plugin.</p><p><a href="https://support.wwpass.com/?topic=604">Learn more...</a></p>';le(r,"WWPass &mdash; No Software Found",e)}else t===d.UNSUPPORTED_PLATFORM&&le(ue(function(){for(var t=navigator.userAgent,e=["Android","iPhone","iPad"],n=0;n<e.length;n+=1)if(-1!==t.search(new RegExp(e[n],"i")))return e[n];return null}()),"WWPass &mdash; Unsupported Platform",e)},de="_wwpass_plugin",he="application/x-wwauth",pe={},ge=[],ve=function(){return void 0!==navigator.mimeTypes[he]},we=function(a){return new Promise(function(e,n){if(Zt)void 0!==window._wwpass_plugin_loaded?ge.push([e,n]):(a("%s: plugin is already initialized","getPluginInstance"),e(Zt));else{var t=0===navigator.mimeTypes.length;if(ve()||t){a("%s: trying to create plugin instance(junkBrowser=%s, timeout=%d)","getPluginInstance",t,t?1e3:1e4);var r="<object id='".concat(de,"' width=0 height=0 type='").concat(he,"'><param name='onload' value='_wwpass_plugin_loaded'/></object>"),o=document.createElement("div");o.setAttribute("style","position: fixed; left: 0; top:0; width: 1px; height: 1px; z-index: -1; opacity: 0.01"),document.body.appendChild(o),o.innerHTML+=r,Zt=document.getElementById(de);var i=setTimeout(function(){delete window._wwpass_plugin_loaded,Zt=null,a("%s: WWPass plugin loading timeout","getPluginInstance"),n({code:d.NO_AUTH_INTERFACES_FOUND,message:s});for(var t=0;t<ge.length;t+=1){(0,ge[t][1])({code:d.NO_AUTH_INTERFACES_FOUND,message:s})}},1e4);window._wwpass_plugin_loaded=function(){a("%s: plugin loaded","getPluginInstance"),delete window._wwpass_plugin_loaded,clearTimeout(i);try{pe.versionString=Zt.version,pe.revision=parseInt(Zt.version.split(".")[2],10),pe.showsErrors=function(t){if("string"==typeof t){for(var e=t.split("."),n=0;n<e.length;n+=1)e[n]=parseInt(e[n],10);if(3===e.length&&(2<e[0]||2===e[0]&&4<e[1]||2===e[0]&&4===e[1]&&1305<=e[2]))return!0}return!1}(pe.versionString)}catch(t){a("%s: error parsing plugin version: %s","getPluginInstance",t)}e(Zt);for(var t=0;t<ge.length;t+=1){(0,ge[t][0])(Zt)}}}else a("%s: no suitable plugins installed","getPluginInstance"),n({code:d.NO_AUTH_INTERFACES_FOUND,message:s})}})},ye=function(t){return new Promise(function(n,o){var i=f({},{log:function(){}},t);i.log('%s: called, operation name is "%s"',"wwpassPluginExecute",i.operation||null),we(i.log).then(function(t){var r,e=(r=function(t,e){t===d.OK?n(e):o({code:t,message:e})},pe.showsErrors?r:function(t,e){if(t!==d.OK&&t!==d.USER_REJECT){var n="<p><b>A error has occured:</b> ".concat(e,"</p>")+'<p><a href="https://support.wwpass.com/?topic='.concat(t,'">Learn more</a></p>');le(n,"WWPass Error",function(){r(t,e)})}else r(t,e)});void 0!==t.execute?(i.callback=e,t.execute(i)):"auth"===i.operation?pe.revision<9701?t.authenticate(i.ticket,e):t.authenticate(i.ticket,e,i.firstKeyType||"passkey"):t.do_operation(i.operation,e)}).catch(o)})},me=function(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:function(){};return new Promise(function(e,t){we(n).then(function(t){t.on_key_removed(e)}).catch(t)})},Ee=!1,be=function(){return null!==(document.querySelector('meta[property="wwpass:extension:version"]')||document.getElementById("_WWAuth_Chrome_Installed_"))},Re=function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:function(){};return new Promise(function(r,o){if(Ee)return n("%s: chrome native messaging extension is not installed","wwpassNMExecute"),void o({code:d.NO_AUTH_INTERFACES_FOUND,message:s});!function t(e){var n,r=e.condition;if("function"==typeof r&&(r=r()),r)e.onCondition();else{var o=e.attempts||0;if(o--){var i=e.timeout||100;setTimeout((n={timeout:i,attempts:o,condition:e.condition,onCondition:e.onCondition,onTimeout:e.onTimeout},function(){t(n)}),i)}else e.onTimeout()}}({timeout:200,attempts:15,condition:be,onCondition:function(){var n=(4294967296*(1+Math.random())|0).toString(16).substring(1);window.postMessage({type:"_WWAuth_Message",src:"client",id:n,func:t,args:e?JSON.parse(JSON.stringify(e)):e},"*"),window.addEventListener("message",function t(e){if("_WWAuth_Message"===e.data.type&&"plugin"===e.data.src&&e.data.id===n)if(window.removeEventListener("message",t,!1),e.data.code===d.NO_AUTH_INTERFACES_FOUND){le('<p>No Security Pack is found on your computer or WWPass&nbsp;native&nbsp;host is not responding.</p><p>To install Security Pack visit <a href="https://ks.wwpass.com/download/">Key Services</a> </p><p><a href="https://support.wwpass.com/?topic=604">Learn more...</a></p>',"WWPass Error",function(){o({code:e.data.code,message:e.data.ticketOrMessage})})}else e.data.code===d.OK?r(e.data.ticketOrMessage):o({code:e.data.code,message:e.data.ticketOrMessage})},!1)},onTimeout:function(){Ee=!0,n("%s: chrome native messaging extension is not installed","wwpassNMExecute"),o({code:d.NO_AUTH_INTERFACES_FOUND,message:s})}})})},Te=function(t){var e=f({},{log:function(){}},t),n=e.log;return delete e.log,n("%s: called","wwpassNMExecute"),e.uri={domain:window.location.hostname,protocol:window.location.protocol},Re("exec",[e],n)},_e=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:function(){};return Re("on_key_rm",void 0,t)},Ae=function e(n,r,o,i){n.pop()(r).then(o,function(t){t.code===d.NO_AUTH_INTERFACES_FOUND?0<n.length?e(n,r,o,i):(fe(t.code,function(){}),i(t)):i(t)})},Ce=function(r,o,i){return new Promise(function(t,e){var n=function(){for(var t=navigator.userAgent,e=["Android","iPhone","iPad"],n=0;n<e.length;n+=1)if(-1!==t.search(new RegExp(e[n],"i")))return e[n];return null}();null===n?ve()?Ae([r,o],i,t,e):Ae([o,r],i,t,e):fe(d.UNSUPPORTED_PLATFORM,function(){e({code:d.UNSUPPORTED_PLATFORM,message:ue(n)})})})},Ne=function(r){return x(r.ticketURL).then(function(t){var e=A(t),n=e.ticket;return S(n,e.ttl).then(function(t){return e={ticket:n,clientKeyNonce:void 0!==t?g(t):void 0,log:r.log},Ce(Te,ye,f({},e,{operation:"auth"}));var e}).then(function(){return n})})},ke=function(i){return new Promise(function(e,n){var t,r=f({},{ticketURL:"",callbackURL:"",ppx:"wwp_",log:function(){}},i);r.passkeyButton||n({ppx:r.ppx,version:r.version,code:d.INTERNAL_ERROR,message:"Cannot find passkey element",callbackURL:r.callbackURL}),0===r.passkeyButton.innerHTML.length&&r.passkeyButton.appendChild(((t=document.createElement("button")).innerHTML='<svg id="icon-button_logo" viewBox="0 0 34 20" style="fill: none; left: 28px; stroke-width: 2px; width: 35px; height: 25px; top: 5px; position: absolute;"><switch><g><title>button_logo</title><path fill="#FFF" d="M31.2 20h-28c-1.7 0-3-1.3-3-3V3c0-1.7 1.3-3 3-3h27.4C32.5 0 34 1.6 34 3.6c0 1.3-.8 2.5-1.9 3L34 16.8c.2 1.6-.9 3-2.5 3.1-.1.1-.2.1-.3.1zM27 6h-1c-1.1 0-2 .9-2 2v1h-8.3c-.8-2.8-3.8-4.4-6.5-3.5S4.8 9.2 5.6 12s3.8 4.4 6.5 3.5c1.7-.5 3-1.8 3.5-3.5H27V6zm-1 1c-.6 0-1 .4-1 1v2H12.1V8.3c0-.2-.1-.3-.2-.3h-.2l-3.6 2.3c-.1.1-.2.3-.1.4l.1.1 3.6 2.2c.1.1.3 0 .4-.1V11H26V7z"></path></g></switch></svg> Log in with PassKey',t.setAttribute("style",'color: white; background-color: #2277E6; font-weight: 400; font-size: 18px; line-height: 36px; font-family: "Arial", sans-serif; padding-right: 15px; cursor: pointer; height: 40px; width: 255px; border-radius: 3px; border: 1px solid #2277E6; padding-left: 60px; text-decoration: none; position: relative;'),t));var o=!1;r.passkeyButton.addEventListener("click",function(t){o||(o=!0,Ne(r).then(function(t){o=!1,e({ppx:r.ppx,version:r.version,code:d.OK,message:"OK",ticket:t,callbackURL:r.callbackURL,hw:!0})},function(t){o=!1,t.code?(t.code===d.INTERNAL_ERROR||i.returnErrors)&&n({ppx:r.ppx,version:r.version,code:t.code,message:t.message,callbackURL:r.callbackURL}):i.log("passKey error",t)})),t.preventDefault()},!1)}).then(M,M)};"console"in window&&window.console.log&&window.console.log("WWPass frontend library version ".concat("2.0.3")),window.WWPass={authInit:function(t){var e,n,r=f({},{ticketURL:"",callbackURL:"",hw:!1,ppx:"wwp_",version:2,log:function(){}},t);r.callbackURL=(e=r.callbackURL,(n=document.createElement("a")).href=e,n.href),r.passkeyButton="string"==typeof r.passkey?document.querySelector(r.passkey):r.passkey,r.qrcode="string"==typeof r.qrcode?document.querySelector(r.qrcode):r.qrcode;var o=[];return r.passkeyButton&&o.push(ke(r)),o.push(ae(r)),Promise.race(o)},openWithTicket:function(e){return new Promise(function(n){var r=f({},{ticket:"",ttl:120,callbackURL:"",ppx:"wwp_",away:!0},e);if(_(r.ticket))I(r.ticket,r.ttl).then(function(t){r=f({},r,{clientKey:b(t)});var e=B(r);r.away?window.location.href=e:n(e)});else{var t=B(r);r.away?window.location.href=t:n(t)}})},isClientKeyTicket:_,cryptoPromise:t,copyClientNonce:function(t,e,r){return P(t).then(function(n){return N(e).then(function(t){var e=k();e.push({hash:t,key:g(n),deadline:window.Date.now()+1e3*r}),L(e)})})},updateTicket:function(e){return fetch(e,{cache:"no-store",headers:O}).then(function(t){if(!t.ok)throw Error('Error updating ticket from "'.concat(e,'": ').concat(t.statusText));return t.json()}).then(function(e){if(!e.newTicket||!e.oldTicket||!e.ttl)throw Error("Invalid response ot updateTicket: ".concat(e));var t={ticket:e.newTicket,ttl:e.ttl};return _(e.newTicket)?p({ticket:e.newTicket,clientKeyOnly:!0}).then(function(t){if(!t.clientKey)throw Error("No client key associated with the ticket ".concat(e.newTicket));return P(t.originalTicket?t.originalTicket:e.newTicket,t.ttl)}).then(function(){return t}):t})},pluginPresent:function(){return ve()||be()},waitForRemoval:function(){return Ce(_e,me)},STATUS:d}}();
//# sourceMappingURL=wwpass-frontend.min.js.map
